# Default configuration for Vulnera Rust

[server]
host = "0.0.0.0"
port = 3000
workers = 4
enable_docs = true
request_timeout_seconds = 30
allowed_origins = []

[server.security]
enforce_https = false
enable_security_headers = false
sanitize_errors = false
hsts_max_age = 31536000         # 1 year in seconds
hsts_include_subdomains = true

[server.rate_limit]
enabled = true
requests_per_minute = 60
requests_per_hour = 1000
unauthenticated_requests_per_day = 10
strategy = "ip"
cleanup_interval_seconds = 300

[cache]
ttl_hours = 24
l1_cache_size_mb = 100
l1_cache_ttl_seconds = 300
enable_cache_compression = true
compression_threshold_bytes = 10240
# Dragonfly DB configuration
dragonfly_url = "redis://127.0.0.1:6379"
dragonfly_connection_timeout_seconds = 5

[analysis]
max_concurrent_packages = 8
max_concurrent_registry_queries = 10
max_concurrent_api_calls = 12
job_queue_capacity = 64
max_job_workers = 8
# Extension-friendly settings
extension_batch_size_limit = 25    # Max files per batch for extension requests
enable_response_compression = true # Enable gzip compression for responses
cache_extension_results = true     # Cache results for faster repeated analysis

[sync]
# Background vulnerability data synchronization
enabled = true
interval_hours = 6            # Re-sync every 6 hours
on_startup = true             # Sync immediately on server start
shutdown_timeout_seconds = 30 # Max wait time for sync task on shutdown

[auth]
# JWT secret key - MUST be set via VULNERA__AUTH__JWT_SECRET environment variable
# The secret should be at least 32 characters long and randomly generated
# Example: openssl rand -hex 32
jwt_secret = "${JWT_SECRET:-MUST_SET_JWT_SECRET_IN_ENVIRONMENT}"
token_ttl_hours = 24
refresh_token_ttl_hours = 720                                    # 30 days
api_key_length = 32
api_key_ttl_days = 365                                           # 1 year, set to null for no expiration

# Cookie-based authentication settings
cookie_domain = ""                  # Empty for localhost, set to your domain in production (e.g., "vulnera.io")
cookie_secure = false               # Set to true in production (requires HTTPS)
cookie_same_site = "lax"            # Options: "strict", "lax", "none" (lax recommended for most use cases)
cookie_path = "/"                   # Path for access token cookie
refresh_cookie_path = "/api/v1/auth/refresh"  # Path for refresh token cookie (restricted to refresh endpoint)
csrf_token_bytes = 32               # Size of CSRF token (256 bits of entropy)
blacklist_tokens_on_logout = true   # Add tokens to blacklist on logout (requires cache)

[database]
# Database connection URL (can also be set via DATABASE_URL env var)
# Override via VULNERA__DATABASE__URL environment variable
url = "postgres://postgres:postgres@localhost/vulnera"
max_connections = 10
min_idle = 2
connect_timeout_seconds = 30
max_lifetime_seconds = 1800
idle_timeout_seconds = 600
enable_health_checks = true

[apis.nvd]
base_url = "https://services.nvd.nist.gov/rest/json"
timeout_seconds = 30
rate_limit_per_30s = 5                               # Without API key, 50 with API key

[apis.ghsa]
graphql_url = "https://api.github.com/graphql"
timeout_seconds = 30
# token = "your_github_token_here"  # Set via environment variable VULNERA__APIS__GHSA__TOKEN

[apis.github]
base_url = "https://api.github.com"
# If unset, server may reuse GHSA token when reuse_ghsa_token=true
token = ""
reuse_ghsa_token = true
timeout_seconds = 30
max_concurrent_file_fetches = 8
max_files_scanned = 200
max_total_bytes = 2000000
max_single_file_bytes = 1000000
backoff_initial_ms = 500
backoff_max_retries = 3
backoff_jitter = true

[logging]
level = "info"
format = "json"

# Popular packages configuration for vulnerability listing
[popular_packages]
# Cache TTL for popular package vulnerability listings (in hours)
cache_ttl_hours = 24
