# CVE-2019-10744: Prototype Pollution in lodash merge-style APIs
# Impact: Prototype manipulation leading to auth bypass / logic tampering

id: "CVE-2019-10744"
name: "Lodash Merge Prototype Pollution"
language: "javascript"
vulnerability_type: "prototype_pollution"
severity: "high"
cwe:
  - "CWE-1321"
impact: "Prototype chain poisoning can alter security-sensitive object behavior across the process"
description: |
  Prototype pollution happens when untrusted object keys like __proto__, constructor,
  or prototype are merged into application objects. This can corrupt global object
  behavior and bypass authorization or validation logic.

test_cases:
  - name: "lodash merge with untrusted JSON payload"
    vulnerable: true
    code: |
      const _ = require('lodash');

      function mergeUserConfig(input) {
          const defaults = { role: 'user' };
          const payload = JSON.parse(input);
          return _.merge({}, defaults, payload);
      }
    expected_findings:
      - rule_id: "prototype_pollution"
        line: 6
        severity: "high"
        message_contains: "merge"

  - name: "defaultsDeep with request body"
    vulnerable: true
    code: |
      const _ = require('lodash');

      function buildConfig(req) {
          return _.defaultsDeep({}, req.body, { secure: true });
      }
    expected_findings:
      - rule_id: "lodash-prototype-pollution"
        line: 4
        severity: "high"

  - name: "safe explicit allowlist assignment"
    vulnerable: false
    code: |
      function safeMerge(input) {
          const payload = JSON.parse(input);
          const safe = {
              theme: payload.theme,
              language: payload.language,
          };
          return { role: 'user', ...safe };
      }
    expected_findings: []
